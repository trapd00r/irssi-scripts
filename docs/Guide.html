<html><head><title>Guide To Irssi Scripting.</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="podstyle" type="text/css" href="podstyle.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010001 at Wed Aug  4 17:53:47 2010 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#LOADING_AND_UNLOADING_SCRIPTS'>LOADING AND UNLOADING SCRIPTS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#File_Locations'>File Locations</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Autorunning_Scripts'>Autorunning Scripts</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Testing'>Testing</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#%2FSCRIPT_EXEC'>/SCRIPT EXEC</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Loading'>Loading</a>
    <li class='indexItem indexItem2'><a href='#Unloading'>Unloading</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#ANATOMY_OF_A_SCRIPT'>ANATOMY OF A SCRIPT</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Preamble'>Preamble</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#COMMONLY_SCRIPTED_TASKS'>COMMONLY SCRIPTED TASKS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Modifying_an_input_line_before_sending'>Modifying an input line before sending</a>
    <li class='indexItem indexItem2'><a href='#Responding_to_a_public_message'>Responding to a public message</a>
    <li class='indexItem indexItem2'><a href='#Responding_to_a_private_message'>Responding to a private message</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#USEFUL_THINGS'>USEFUL THINGS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Getting_the_Response_Value_of_a_Remote_Command'>Getting the Response Value of a Remote Command</a>
    <li class='indexItem indexItem2'><a href='#Getting_the_Response_Value_of_a_Local_Command'>Getting the Response Value of a Local Command</a>
    <li class='indexItem indexItem2'><a href='#Sharing_Code_Between_Scripts'>Sharing Code Between Scripts</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Using_Signals'>Using Signals</a>
      <li class='indexItem indexItem3'><a href='#Using_Functions'>Using Functions</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#If_In_Doubt%2C_Dump!'>If In Doubt, Dump!</a>
    <li class='indexItem indexItem2'><a href='#Making_Scripts_Act_Native'>Making Scripts Act Native</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Provide_Help'>Provide Help</a>
      <li class='indexItem indexItem3'><a href='#Use_Tab_Completion'>Use Tab Completion</a>
      <li class='indexItem indexItem3'><a href='#Use_Settings_for_Customisation'>Use Settings for Customisation</a>
      <li class='indexItem indexItem3'><a href='#Use_Subcommands_to_Group_Script_Functionality'>Use Subcommands to Group Script Functionality</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR_%26_THANKS'>AUTHOR &#38; THANKS</a>
  <li class='indexItem indexItem1'><a href='#OTHER_RESOURCES'>OTHER RESOURCES</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Guide To Irssi Scripting.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LOADING_AND_UNLOADING_SCRIPTS"
>LOADING AND UNLOADING SCRIPTS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="File_Locations"
>File Locations</a></h2>

<p>Packaged Irssi script files are usually placed in <em>/usr/share/irssi/scripts/</em>,
but custom scripts or those required by a single user can be placed in <em>~/.irssi/scripts/</em>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Autorunning_Scripts"
>Autorunning Scripts</a></h3>

<p>If you require a script be run when Irssi starts,
you can place the file (or better,
create a symlink to it) into <em>~/.irssi/scripts/autorun/</em>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Testing"
>Testing</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="/SCRIPT_EXEC"
><code>/SCRIPT EXEC</code></a></h3>

<p><b>TODO: Using it for testing stuff out</b></p>

<p><b>TODO: Also for very short scripts (with -permanent?)</b></p>

<p><b>TODO: Quoting rules for vars and things?</b></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Loading"
>Loading</a></h2>

<p>Scripts are loaded via <code>/SCRIPT LOAD <i>filename</i></code>.
A default Irssi configuration also provides the <code>/RUN</code> alias as an alternative to <code>/SCRIPT LOAD</code>.</p>

<p>Loaded scripts will exist in the Irssi namespace as: <code>Irssi::Script::<i>&#60;name&#62;</i></code>,
where <i>name</i> is the filename stripped of its <em>.pl</em> extension.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Unloading"
>Unloading</a></h2>

<p>A script can be unloaded via the <code>/SCRIPT UNLOAD <i>name</i></code> command.
The name is typically the script filename without the <em>.pl</em> extension,
so <em>nickcolor.pl</em> becomes <code>/SCRIPT UNLOAD nickcolor</code>.</p>

<p>As part of the unloading process,
if the script contains a</p>

<pre>    sub UNLOAD {
        ...
    }</pre>

<p>function, it will be run just before the script is unloaded and all variables destroyed. This can be used to clean up any temporary files, shut down any network connections or processes, and restore any Irssi modifications made.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ANATOMY_OF_A_SCRIPT"
>ANATOMY OF A SCRIPT</a></h1>

<p>In this section, we develop a very simplistic script and look at the necessary code.</p>

<p><b>Note:</b> This section has considerable overlap with <a href="http://juerd.nl/site.plp/irssiscripttut" class="podlinkurl"
>Juerd&#39;s Scripting Tutorial</a>, which you may also wish to read.</p>

<p><b>TODO: Figure out a basic script to use as an example</b></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Preamble"
>Preamble</a></h2>

<p>All scripts should contain a header as follows:</p>

<pre>    use strict;
    use warnings;

    use vars qw($VERSION %IRSSI);
    use Irssi;

    $VERSION = &#39;1.00&#39;;
    %IRSSI = (
        authors     =&#62; &#39;Author Name(s)&#39;,
        contact     =&#62; &#39;author_email@example.com&#39;,
        name        =&#62; &#39;Script Title&#39;,
        description =&#62; &#39;Longer script description &#39;,
        license     =&#62; &#39;Public Domain&#39;,
    );</pre>

<p>The first two lines should be used in <b>all</b> perl scripts, not just Irssi. They provide far greater error checking and diagnostics should you make a mistake in your code.</p>

<p>The <code>use vars qw($VERSION %IRSSI)</code> defines two global variables, which are then set below to the appropriate values.</p>

<p><code>use Irssi</code> tells the script to make the various <a href="./Irssi.html" class="podlinkpod"
>Irssi</a> support functions available. Additional parameters passed here with <code>qw/.../</code> can be used to import functions into the current script namespace.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COMMONLY_SCRIPTED_TASKS"
>COMMONLY SCRIPTED TASKS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Modifying_an_input_line_before_sending"
>Modifying an input line before sending</a></h2>

<p><b>TODO: catch &#34;send text&#34;, modify it if necessary, signal_emit it</b></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Responding_to_a_public_message"
>Responding to a public message</a></h2>

<p><b>TODO: catch &#34;messsage public&#34;, check params, generate response</b></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Responding_to_a_private_message"
>Responding to a private message</a></h2>

<p><b>TODO: catch &#34;messsage private&#34;, check params, generate response</b></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="USEFUL_THINGS"
>USEFUL THINGS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Getting_the_Response_Value_of_a_Remote_Command"
>Getting the Response Value of a Remote Command</a></h2>

<p><b>TODO: Add bazerka&#39;s snippet here</b></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Getting_the_Response_Value_of_a_Local_Command"
>Getting the Response Value of a Local Command</a></h2>

<p><b>TODO: How?!??</b></p>

<p>There is no simple way to achieve this. The data backing most common activities can be extracted through other API calls, but there are some exceptions.</p>

<p>Maybe, look up the format, intercept gui print text, try to match it against what you&#39;re expecting?</p>

<p>Can this be generalised at all?</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Sharing_Code_Between_Scripts"
>Sharing Code Between Scripts</a></h2>

<p>There are 2 main ways for scripts to communicate, either via emitting and handling Irssi signals, or by calling functions from one another directly.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Using_Signals"
>Using Signals</a></h3>

<p>In order to use custom signals, they must first be registered with Irssi. During registration, a list of the parameters must also be specified. Once specified, it cannot be changed without restarting Irssi, so be warned.</p>

<p>After registration, your script can simply listen for signals with <a href="./Irssi.html#signal_add_%24sig_name%2C_%24func" class="podlinkpod"
>Irssi::signal_add</a>, or generate them for others to handle with <a href="./Irssi.html#signal_emit_%24sig_name%2C_%40params" class="podlinkpod"
>Irssi::signal_emit</a></p>

<p>For example:</p>

<p><b>TODO: Example here</b></p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Using_Functions"
>Using Functions</a></h3>

<p>Because scripts exist in a well-defined namespace of <code>Irssi::Script::SOMEPACKAGE</code>, it is possible to manipulate the perl symbol table to call functions directly on them, assuming they are loaded.</p>

<p>Because the following code depends on <i>symbolic references</i>, it is necessary to tell Perl to allow them, despite normally being prohibited by <code>use strict</code>. The <code>no strict &#39;refs&#39;;</code> line takes care of this, and reenables them at the end of the snippet.</p>

<pre>    no strict &#39;refs&#39;;
    if (defined %{ &#39;Irssi::Script::SOMEPACKAGE::&#39; }) {
        if (defined &#38;{&#39;Irssi::Script::SOMEPACKAGE::SOME_FUNC&#39;} ) {
            (&#38;{&#39;Irssi::Script::SOMEPAKAGE::SOME_FUNC&#39;}(@args));
        } else {
            print(&#34;Err: can&#39;t find Irssi::Script::SOMEPACKAGE::SOME_FUNC&#34;);
        }
      }
    use strict &#39;refs&#39;;</pre>

<p>Here, <code>SOMEPACKAGE</code> is the name of the script package which contains the function you want to call, and <code>SOME_FUNC</code> is the name of the function within it you wish to call. The first 2 <code>defined(..)</code> lines take care of ensuring that the package and function exist, and generate an error otherwise. Other error handling is possible, including executing a <code>/SCRIPT LOAD</code> to load the necessary script and retry, but is not shown here.</p>

<p><i>This snippet was provided by <code>Bazerka</code> on Freenode/#irssi</i>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="If_In_Doubt,_Dump!"
>If In Doubt, Dump!</a></h2>

<p><code>Data::Dumper</code> is an extremely good way to inspect Irssi internals if you&#39;re looking for an undocumented feature.</p>

<p>The <code>DUMP</code> alias by <a href="http://wouter.coekaerts.be/site/irssi/aliases" class="podlinkurl"
>Wouter Coekaerts</a> provides an easy way to check object fields.</p>

<p>Dump perl object (e.g. <code>/dump Irssi::active_win</code>):</p>

<pre>    /alias DUMP script exec use Data::Dumper\; print Data::Dumper-&#62;new([\\$0-])-&#62;Dump</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Making_Scripts_Act_Native"
>Making Scripts Act Native</a></h2>

<p>An important part of creating a good script is to make it behave as though it were a part of Irssi. Adhering to some of the standard conventions can make this easier.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Provide_Help"
>Provide Help</a></h3>

<p>Scripts commonly store information about how to use them in comments at the top of their file. Whilst better than no documentation at all, a preferable approach is to allow that help to be accessed from within Irssi itself, using the <code>/HELP</code> command.</p>

<pre>    my $help = &#34;this is help for b&#34;;

    Irssi::command_bind(&#39;help&#39;, sub {
            if ($_[0] eq &#39;test_b&#39;) {
                Irssi::print($help, MSGLEVEL_CLIENTCRAP);
                Irssi::signal_stop;
            }
      }
    );</pre>

<p>This example demonstrates overriding the <code>/HELP</code> command, and if the argument matches our command, print some custom help and prevent the internal Irssi help function from being called. Otherwise, it falls back to the default help.</p>

<p><i>This snippet was provided by <code>culb</code> on Freenode/#irssi</i>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Use_Tab_Completion"
>Use Tab Completion</a></h3>

<p>One of the great features of Irssi is the ability to complete commands, subcommands and even certain arguments. Using the subcommands processing feature described below automatically allows those subcommands to be tab-completed, but for more complex tasks, you can hook into the autocompletion system itself.</p>

<p>In order to create your own completions, you must intercept the <code>&#34;complete word&#34;</code> signal and return a list of completion candidates.</p>

<pre>    sub do_complete {
        my ($strings, $window, $word, $linestart, $want_space) = @_;

        # only provide these completions if the input line is otherwise empty.
        return unless ($linestart eq &#39;&#39; &#38;&#38; $word eq &#39;&#39;);

        # add the completion candidates
        push @$strings, qw/foo bar baz bacon/;

        # indicate that we want to include a space after the completion
        $$want_space = 1;

        # prevent internal Irssi completion from responding
        Irssi::signal_stop;
    }

    Irssi::signal_add_first(&#39;complete word&#39;,  \&#38;do_complete);</pre>

<p><i>This snippet taken from <a href="http://scripts.irssi.org/scripts/complete_lastspoke.pl" class="podlinkurl"
><em>complete_lastspoke.pl</em></a> by Daenyth</i></p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Use_Settings_for_Customisation"
>Use Settings for Customisation</a></h3>

<p>Many scripts require the setting of various parameters to affect how they behave. One approach is to require the user to directly edit the script file, but this is less than ideal for a number of reasons. Firstly, it is easy to introduce errors into a script by accidentally deleting closing quotes or semicolons. Secondly, it has no effect until the script is reloaded, leading to confusion.</p>

<p>A much better alternative is to use Irssi&#39;s inbuilt settings mechanism to allow users to set these parameters from within Irssi, as well as to <code>/SAVE</code> their settings for subsequent invocations.</p>

<p><b>TODO: different types of settings</b></p>

<p><b>TODO: register/set/get</b></p>

<p><b>TODO: Listening for changes and acting accordingly</b></p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Use_Subcommands_to_Group_Script_Functionality"
>Use Subcommands to Group Script Functionality</a></h3>

<p>A common theme in Irssi scripts is to define commands with a prefix, such as <code>/myscript_foo</code>, <code>myscript_bar</code>, etc. This helps to avoid accidentally clobbering native commands and those defined by other scripts, but is a problem better solved with <i>subcommands</i>.</p>

<p>Subcommands allow you to bind commands such as <code>/myscript foo</code> and <code>/myscript bar</code>. Completions are automatically handled for both the primary command, and any subcommands contained within it.</p>

<p>The following example demonstrates how to use subcommands from within a script:</p>

<pre>    Irssi::command_bind(&#34;foo bar&#34;, \&#38;subcmd_bar);
    Irssi::command_bind(&#34;foo&#34;, \&#38;subcmd_handler);

    sub subcmd_handler {
        my ($data, $server, $item) = @_;
        $data =~ s/\s+$//g; # strip trailing whitespace.
        Irssi::command_runsub(&#39;foo&#39;, $data, $server, $item);
    }

    sub subcmd_bar {
        my ($args) = @_;
        print &#34;subcommand called with: $args&#34;;
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR_&#38;_THANKS"
>AUTHOR &#38; THANKS</a></h1>

<p>This page was written by Tom Feist <code>shabble+irssi@metavore.org</code>, but draws on the help of many many people.</p>

<p>The denizens of Freenode/#irssi have been particularly helpful, especially <code>Bazerka</code> and <code>culb</code>.</p>

<p>To report bugs or suggestions, email me at the address before, or come talk to me in <code>#irssi</code> on <code>irc.freenode.net</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OTHER_RESOURCES"
>OTHER RESOURCES</a></h1>

<p>The documentation assembled here and elsewhere on this site has been drawn from many different places, and a lot of valuable information is available from the following sites.</p>

<dl>
<dt><a name="http://irssi.org/documentation/perl"
><a href="http://irssi.org/documentation/perl" class="podlinkurl"
>http://irssi.org/documentation/perl</a>
<dt><a name="http://irssi.org/documentation/signals"
><a href="http://irssi.org/documentation/signals" class="podlinkurl"
>http://irssi.org/documentation/signals</a>
<dt><a name="http://irssi.org/documentation/special_vars"
><a href="http://irssi.org/documentation/special_vars" class="podlinkurl"
>http://irssi.org/documentation/special_vars</a>
<dt><a name="http://irssi.org/documentation/formats"
><a href="http://irssi.org/documentation/formats" class="podlinkurl"
>http://irssi.org/documentation/formats</a>
<dt><a name="http://irssi.org/documentation/settings"
><a href="http://irssi.org/documentation/settings" class="podlinkurl"
>http://irssi.org/documentation/settings</a>
<dt><a name="http://juerd.nl/site.plp/irssiscripttut"
><a href="http://juerd.nl/site.plp/irssiscripttut" class="podlinkurl"
>http://juerd.nl/site.plp/irssiscripttut</a>
<dt><a name="http://irchelp.org/irchelp/rfc/rfc.html"
><a href="http://irchelp.org/irchelp/rfc/rfc.html" class="podlinkurl"
>http://irchelp.org/irchelp/rfc/rfc.html</a>
<dt><a name="http://wouter.coekaerts.be/site/irssi/irssi"
><a href="http://wouter.coekaerts.be/site/irssi/irssi" class="podlinkurl"
>http://wouter.coekaerts.be/site/irssi/irssi</a></a></dt>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
